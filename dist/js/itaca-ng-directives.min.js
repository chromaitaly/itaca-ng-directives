/*******************************************************************************
********************************************************************************
********************************************************************************
***	   itaca-ng-directives														 
***    Copyright (C) 2016   Chroma Italy Hotels srl	 
***                                                                          
***    This program is free software: you can redistribute it and/or modify  
***    it under the terms of the GNU General Public License as published by  
***    the Free Software Foundation, either version 3 of the License, or     
***    (at your option) any later version.                                   
***                                                                          
***    This program is distributed in the hope that it will be useful,       
***    but WITHOUT ANY WARRANTY; without even the implied warranty of        
***    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         
***    GNU General Public License for more details.                          
***                                                                          
***    You should have received a copy of the GNU General Public License     
***    along with this program.  If not, see <http://www.gnu.org/licenses/>. 
********************************************************************************
********************************************************************************
*******************************************************************************/
!function(){"use strict";angular.module("itaca.directives",["ngMaterial","itaca.services","itaca.utils","pascalprecht.translate","tmh.dynamicLocale"]),angular.module("itaca.directives").config(["$windowProvider","$translateProvider","tmhDynamicLocaleProvider",function(e,t,n){var i=(e.$get().navigator.language||e.$get().navigator.userLanguage).split("-")[0].toLowerCase();t.useLoader("i18nLoader"),t.preferredLanguage(i),t.useCookieStorage(),t.useMissingTranslationHandlerLog(),$translateSanitizationProvider.addStrategy("sce","sceStrategy"),t.useSanitizeValueStrategy("sce"),n.localeLocationPattern("/resources/public/js/i18n/angular-locale_{{locale}}.js"),n.useCookieStorage(),n.defaultLocale(i)}])}(),function(){"use strict";function e(e,t){return{restrict:"A",link:function(e,t,n){var i=angular.element(t);e.$watchGroup([function(){return n.chAnimated},function(){return n.chAnimatedDelay}],function(){_.isNil(e.currentAnimation)||i.removeClass(e.currentAnimation);var t=isFinite(parseInt(n.chAnimatedDelay))?parseInt(n.chAnimatedDelay):0;i.css({"-webkit-animation-delay":t+"ms","animation-delay":t+"ms"}),i.addClass("animated"),i.addClass(n.chAnimated),e.currentAnimation=n.chAnimated})}}}e.$inject=["HtmlUtils","$window"],angular.module("itaca.directives").directive("chAnimated",e)}(),function(){"use strict";function e(e,t,n){return{restrict:"A",link:function(i,a,o){var r=t.get("X-ITACA-AI-HISTORY");r&&r.length||a.addClass("hide");e.$on("$routeChangeSuccess",function(e,n,i,o){if(n.$$route&&!n.$$route.originalPath.includes("login")){var r=n.$$route.originalPath,c=t.get("X-ITACA-AI-HISTORY")||[];c.length&&c.indexOf(r)==c.length-1||(c.push(r),t.set("X-ITACA-AI-HISTORY",c)),c.length&&a.removeClass("hide")}}),a.on("click",function(e){e.preventDefault();var i=t.get("X-ITACA-AI-HISTORY")||[],a=i.length>1?i.splice(-2)[0]:"/";a.includes("login")||(t.set("X-ITACA-AI-HISTORY",i),n.go(a))})}}}e.$inject=["$rootScope","localStorageService","Navigation"],angular.module("itaca.directives").directive("chBackBtn",e)}(),function(){"use strict";function e(e,t,n,i,a){return{restrict:"A",scope:{chDownload:"=",maxRetry:"=?",retryDelay:"=?",onError:"&?"},link:function(o,r,c){o.maxRetry=o.maxRetry||1,o.retryDelay=o.retryDelay||5e3,o.download=function(e){o.downloaded?o.downloaded=!1:(o.attempt=1,o.$$doDownload(e))},o.$$doDownload=function(t){i.start();e.get(o.chDownload).then(function(e){if(e.data.file){if(bowser.ios){var n={file:e.data.file,filename:e.data.filename,contentType:e.data.contentType,title:o.downloadReadyLabel,downloadLabel:o.downloadLabel};a.downloadFile(t,n)}else{var r=o.$$getLinkEl();if(r.href="data:"+(e.data.contentType||"application/octet-stream")+";base64,"+encodeURI(e.data.file),r.setAttribute("download",e.data.filename),o.downloaded=!0,document.createEvent){var c=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});r.dispatchEvent(c)}else r.fireEvent("click")}i.stop()}else o.$$manageRetry(!0)},function(e){412!=e.status&&o.$$manageRetry(507==e.status)||(n.error((e.data,e.data.message?e.data.message:"")),o.onError&&o.onError(e),i.stop())}).finally(function(){o.attempt++},function(){o.attempt++,i.stop()})},o.$$manageRetry=function(e){return o.attempt<o.maxRetry&&(t(o.$$doDownload,e?o.retryDelay:1e3),!0)},o.$$getLinkEl=function(){var e=r[0].querySelector(".ch-download-button-link");return null==e&&((e=document.createElement("a")).setAttribute("target","_blank"),e.className="ch-download-button-link",r[0].appendChild(e)),e};var s=r[0];s.addEventListener("click",o.download),o.$on("$destroy",function(){s.removeEventListener("click",o.download)})}}}e.$inject=["$http","$timeout","$log","Loading","Dialog"],angular.module("itaca.directives").directive("chDownload",e)}(),function(){"use strict";function e(e,t,n){var i=e.$eval(n.chEventsManager);i&&angular.isArray(i)&&_.forEach(i,function(t){if(!(t&&t.event&&t.fn&&angular.isFunction(t.fn)))return!0;e.$on(t.event,function(n,i){t.fn.apply(e,angular.isArray(t.params)?t.params:i||null)})})}e.$inject=["$scope","$element","$attrs"],angular.module("itaca.directives").directive("chEventsManager",function(){return{restrict:"A",controller:e}})}(),function(){"use strict";function e(e){return{restrict:"A",require:"ngModel",scope:{ngModel:"=",chInputCheck:"="},link:function(t,n,i,a){t.check=function(){e.when(t.chInputCheck(t.ngModel),function(e){a.$setValidity("chValid",e),a.$checking=!1},function(){a.$setValidity("chValid",!1),a.$checking=!1},function(){a.$checking=!0})},t.$watchCollection("ngModel",function(e,n){_.isNil(e)||_.isEmpty(e)?a.$setValidity("chValid",!0):(a.$setValidity("chValid",!1),t.check())})}}}e.$inject=["$q"],angular.module("itaca.directives").directive("chInputCheck",e)}(),function(){"use strict";function e(e,t){return{restrict:"A",scope:{defaultImgUrl:"=",maxRetry:"=",hideOnError:"=?",onLoad:"&?"},link:function(n,i,a){function o(){f>=u?_.isNil(n.defaultImgUrl)||(i[0].src=n.defaultImgUrl):(r(),s||(s=setTimeout(function(){c||(c=i[0].src),i[0].src=t.withParam(c,"cache",Date.now().toString()),o(),f++},3e3)))}function r(){if(i.addClass("hide"),i[0].style.setProperty("display","none","important"),!n.hideOnError&&!document.getElementById(d)){var t=angular.element('<md-progress-circular id="'+d+'" class="md-primary ch-progress" md-mode="indeterminate"></md-progress-circular>');i.after(t),e(t)(n)}}var c,s,l=a.loadedClass,d="lipr_"+Date.now(),u=u||3,f=0;n.hideOnError=!!_.isBoolean(n.hideOnError)&&n.hideOnError,i.on("load",function(e){n.onLoad&&n.onLoad(),clearTimeout(s),i.css("display","inherit"),i.addClass(l),i.removeClass("hide");var t=document.getElementById(d);t&&angular.element(t).remove()}),i.on("error",function(){o()}),r(),n.$on("$destroy",function(){clearTimeout(s)})}}}e.$inject=["$compile","UrlBuilder"],angular.module("itaca.directives").directive("lazyImage",e)}(),function(){"use strict";function e(e){return{restrict:"A",require:"mdDatepicker",link:function(t,n,i,a){n.find("input").on("click",function(t){e(a.openCalendarPane.on(a,t))})}}}e.$inject=["$timeout"],angular.module("itaca.directives").directive("mdDatepickerOnClick",e)}(),function(){"use strict";function e(e){return{restrict:"A",require:"mdDatepicker",link:function(e,t,n,i){t.find("input").attr("readonly","readonly")}}}e.$inject=["$timeout"],angular.module("itaca.directives").directive("mdDatepickerReadonly",e)}(),function(){"use strict";function e(e,t){return{restrict:"A",scope:{onClickPanel:"=",ctrl:"@",xPosition:"@",yPosition:"@",hasBackdrop:"=?",disableParentScroll:"=?",disableBodyScroll:"=?",clickOutsideToClose:"=?",hasConfirm:"=?",hasClose:"=?",panelClass:"@",data:"=?",onClose:"&?",zIndex:"@",fullscreen:"=?"},link:function(t,n,i){t.xPosition=_.includes(["CENTER","ALIGN_START","ALIGN_END","OFFSET_START","OFFSET_END"],t.xPosition)?t.xPosition:"CENTER",t.yPosition=_.includes(["CENTER","ALIGN_TOPS","ALIGN_BOTTOMS","ABOVE","BELOW"],t.yPosition)?t.yPosition:"BELOW",t.clickOutsideToClose=t.clickOutsideToClose||!0,t.panelClass=t.panelClass||"bg-white md-whiteframe-15dp",t.hasBackdrop=!!_.isNil(t.hasBackdrop)||t.hasBackdrop;var a=n[0],o=function(e){angular.element(document.body).css({overflow:e?"hidden":"auto"})},r=e.newPanelPosition().relativeTo(n).addPanelPosition(e.xPosition[t.xPosition],e.yPosition[t.yPosition]),c={attachTo:angular.element(document.body),controller:t.ctrl||"basePanelCtrl",controllerAs:"ctrl",templateUrl:t.onClickPanel,position:r,clickOutsideToClose:t.clickOutsideToClose,disableParentScroll:t.disableParentScroll,hasBackdrop:t.hasBackdrop,fullscreen:!!_.isBoolean(t.fullscreen)&&t.fullscreen,panelClass:t.panelClass,locals:{data:t.workingData,hasConfirm:t.hasConfirm,hasClose:t.hasClose},onCloseSuccess:function(e,n){(!(!!_.isBoolean(t.hasConfirm)&&t.hasConfirm)||_.isBoolean(n)&&n)&&(_.assign(t.data,t.workingData),t.onClose&&t.onClose(t.data)),(t.hasBackdrop||t.disableBodyScroll)&&o(!1)},onOpenComplete:function(){(t.hasBackdrop||t.disableBodyScroll)&&o(!0)}};t.zIndex&&(c.zIndex=t.zIndex);var s=function(n){t.data=t.data||{},t.workingData=angular.copy(t.data),c.openFrom=n,c.locals=t.locals||{hasConfirm:t.hasConfirm,hasClose:t.hasClose},c.locals.data=t.workingData,e.open(c)};a.addEventListener("click",s),t.$on("$destroy",function(){a.removeEventListener("click",s)})}}}e.$inject=["$mdPanel","$mdMedia"],angular.module("itaca.directives").directive("onClickPanel",e)}(),function(){"use strict";function e(e,t,n){return{restrict:"A",scope:{socialLogin:"@",provider:"@",reload:"="},link:function(i,a,o){function r(e){e.preventDefault();var n=c(),a="/signin/"+s+"/popup",o="scrollbars=yes, width="+n.w+", height="+n.h+", top="+n.top+", left="+n.left;i.popup=window.open(a,"socialLogin",o),i.stop||(i.stop=t(function(){i.loginCallback()},1e3))}function c(){var e=window.screenLeft?window.screenLeft:window.screenX,t=window.screenTop?window.screenTop:window.screenY;return{w:650,h:650,left:e+window.innerWidth/2-325,top:t+window.innerHeight/2-325}}var s=i.socialLogin||i.provider;i.popup={},i.stopCheck=function(){angular.isDefined(i.stop)&&(t.cancel(i.stop),i.stop=void 0)},i.loginCallback=function(){i.popup&&i.popup.closed&&(e.info("Popup closed"),n.loadUserDetails(),_.isBoolean(i.reload)&&i.reload&&n.reload(),i.unregister())},i.unregister=function(){i.stopCheck()},i.$on("destroy",i.unregister),a.bind("click",function(e){r(e)})}}}e.$inject=["$log","$interval","Navigator"],angular.module("itaca.directives").directive("socialLogin",e)}(),function(){"use strict";function e(e){return{restrict:"A",scope:{parent:"@stickyParent",offset:"@stickyOffset",cssClass:"@stickyClass",parentWidth:"@hasParentWidth",isSticky:"=?"},link:function(t,n,i){var a,o,r,c,s=t.parent?document.querySelector(t.parent):n.parent()[0],l=t.offset||0;t.isSticky=t.isSticky||!1,s.style.position="relative";var d=function(){a=s.offsetHeight,o=s.offsetTop-l,r=n[0].offsetHeight,e.pageYOffset>=o&&e.pageYOffset<=o+(a-r)?(t.isSticky=!0,t.parentWidth&&(c=s.offsetWidth+"px"),n.css({position:"fixed",top:l+"px","z-index":"10",bottom:"",width:c}),t.cssClass&&n.addClass(t.cssClass)):(e.pageYOffset>=o&&e.pageYOffset>o+(a-r)?n.css({position:"absolute",bottom:"0","z-index":"",top:"",width:""}):n.css({position:"absolute",bottom:"","z-index":"",top:"0",width:""}),t.cssClass&&n.removeClass(t.cssClass),t.isSticky=!1)};e.addEventListener("scroll",d),t.$on("$destroy",e.removeEventListener("scroll",d))}}}e.$inject=["$window"],angular.module("itaca.directives").directive("chSticky",e)}(),function(){"use strict";function e(e){return{restrict:"A",require:"?ngModel",link:function(t,n,i,a){e.transform(n,a,function(e){return angular.isString(e)&&e.length>0?e[0].toUpperCase()+e.substr(1).toLowerCase():e})}}}e.$inject=["textTransformService"],angular.module("itaca.directives").directive("textCapitalize",e)}(),function(){"use strict";function e(e){return{restrict:"A",require:"?ngModel",link:function(t,n,i,a){e.transform(n,a,angular.lowercase)}}}e.$inject=["textTransformService"],angular.module("itaca.directives").directive("textLowercase",e)}(),function(){"use strict";function e(e){return{restrict:"A",require:"?ngModel",link:function(t,n,i,a){e.transform(n,a,angular.uppercase)}}}e.$inject=["textTransformService"],angular.module("itaca.directives").directive("textUppercase",e)}(),function(){"use strict";function e(e,t){return{restrict:"A",require:"ngModel",link:function(e,n,i,a){a.$viewChangeListeners.push(function(){if(a.$modelValue&&angular.isDate(a.$modelValue)){var n=i.tzDate;n&&t(i.ngModel).assign(e,moment(a.$modelValue).utcOffset(n,!0).toDate())}})}}}e.$inject=["DateUtils","$parse"],angular.module("itaca.directives").directive("tzDate",e)}(),function(){"use strict";function e(e,t){return{restrict:"A",require:"ngModel",link:function(n,i,a,o){o.$viewChangeListeners.push(function(){o.$modelValue&&angular.isDate(o.$modelValue)&&t(a.ngModel).assign(n,e.absoluteDate(o.$modelValue))})}}}e.$inject=["DateUtils","$parse"],angular.module("itaca.directives").directive("utcDate",e)}();