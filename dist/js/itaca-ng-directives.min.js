/*******************************************************************************
********************************************************************************
********************************************************************************
***	   itaca-ng-directives														 
***    Copyright (C) 2016-2018   Chroma Italy Hotels srl	 
***                                                                          
***    This program is free software: you can redistribute it and/or modify  
***    it under the terms of the GNU General Public License as published by  
***    the Free Software Foundation, either version 3 of the License, or     
***    (at your option) any later version.                                   
***                                                                          
***    This program is distributed in the hope that it will be useful,       
***    but WITHOUT ANY WARRANTY; without even the implied warranty of        
***    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         
***    GNU General Public License for more details.                          
***                                                                          
***    You should have received a copy of the GNU General Public License     
***    along with this program.  If not, see <http://www.gnu.org/licenses/>. 
********************************************************************************
********************************************************************************
*******************************************************************************/
!function(){"use strict";angular.module("itaca.directives",["ngMaterial","itaca.services","itaca.utils","pascalprecht.translate","tmh.dynamicLocale"]),angular.module("itaca.directives").config(["$windowProvider","$translateProvider","tmhDynamicLocaleProvider",function(e,t,n){var i=(e.$get().navigator.language||e.$get().navigator.userLanguage).split("-")[0].toLowerCase();t.useLoader("i18nLoader"),t.preferredLanguage(i),t.useCookieStorage(),t.useMissingTranslationHandlerLog(),$translateSanitizationProvider.addStrategy("sce","sceStrategy"),t.useSanitizeValueStrategy("sce"),n.localeLocationPattern("/resources/public/js/i18n/angular-locale_{{locale}}.js"),n.useCookieStorage(),n.defaultLocale(i)}])}(),function(){"use strict";function e(e,t){return{restrict:"A",link:function(t,e,n){var i=angular.element(e);t.$watchGroup([function(){return n.chAnimated},function(){return n.chAnimatedDelay}],function(){_.isNil(t.currentAnimation)||i.removeClass(t.currentAnimation);var e=isFinite(parseInt(n.chAnimatedDelay))?parseInt(n.chAnimatedDelay):0;i.css({"-webkit-animation-delay":e+"ms","animation-delay":e+"ms"}),i.addClass("animated"),i.addClass(n.chAnimated),t.currentAnimation=n.chAnimated})}}}e.$inject=["HtmlUtils","$window"],angular.module("itaca.directives").directive("chAnimated",e)}(),function(){"use strict";function e(i,c,a){return{restrict:"A",link:function(e,r,t){var s="X-ITACA-AI-HISTORY",n=c.get(s);n&&n.length||r.addClass("hide");i.$on("$routeChangeSuccess",function(e,t,n,i){if(t.$$route&&!t.$$route.originalPath.includes("login")){var a=t.$$route.originalPath,o=c.get(s)||[];o.length&&o.indexOf(a)==o.length-1||(o.push(a),c.set(s,o)),o.length&&r.removeClass("hide")}}),r.on("click",function(e){e.preventDefault();var t=c.get(s)||[],n=1<t.length?t.splice(-2)[0]:"/";n.includes("login")||(c.set(s,t),a.go(n))})}}}e.$inject=["$rootScope","localStorageService","Navigation"],angular.module("itaca.directives").directive("chBackBtn",e)}(),function(){"use strict";function e(i){return{restrict:"A",link:function(e,t,n){i.disable(n.chDisableTransitionsListeners)}}}e.$inject=["TransitionsListener"],angular.module("itaca.directives").directive("chDisableTransitionsListeners",e)}(),function(){"use strict";function e(i,a,r,s,c){return{restrict:"A",scope:{chDownload:"=",maxRetry:"=?",retryDelay:"=?",onError:"&?"},link:function(o,t,e){o.maxRetry=o.maxRetry||1,o.retryDelay=o.retryDelay||5e3,o.download=function(e){o.downloaded?o.downloaded=!1:(o.attempt=1,o.$$doDownload(e))},o.$$doDownload=function(a){s.start();i.get(o.chDownload).then(function(e){if(e.data.file){if(bowser.ios){var t={file:e.data.file,filename:e.data.filename,contentType:e.data.contentType,title:o.downloadReadyLabel,downloadLabel:o.downloadLabel};c.downloadFile(a,t)}else{var n=o.$$getLinkEl();if(n.href="data:"+(e.data.contentType||"application/octet-stream")+";base64,"+encodeURI(e.data.file),n.setAttribute("download",e.data.filename),o.downloaded=!0,document.createEvent){var i=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});n.dispatchEvent(i)}else n.fireEvent("click")}s.stop()}else o.$$manageRetry(!0)},function(e){412!=e.status&&o.$$manageRetry(507==e.status)||(r.error((e.data,e.data.message?e.data.message:"")),o.onError&&o.onError(e),s.stop())}).finally(function(){o.attempt++},function(){o.attempt++,s.stop()})},o.$$manageRetry=function(e){return o.attempt<o.maxRetry&&(a(o.$$doDownload,e?o.retryDelay:1e3),!0)},o.$$getLinkEl=function(){var e=t[0].querySelector(".ch-download-button-link");return null==e&&((e=document.createElement("a")).setAttribute("target","_blank"),e.className="ch-download-button-link",t[0].appendChild(e)),e};var n=t[0];n.addEventListener("click",o.download),o.$on("$destroy",function(){n.removeEventListener("click",o.download)})}}}e.$inject=["$http","$timeout","$log","Loading","Dialog"],angular.module("itaca.directives").directive("chDownload",e)}(),function(){"use strict";function e(i,e,t){var n=i.$eval(t.chEventsManager);n&&angular.isArray(n)&&_.forEach(n,function(n){if(!(n&&n.event&&n.fn&&angular.isFunction(n.fn)))return!0;i.$on(n.event,function(e,t){n.fn.apply(i,angular.isArray(n.params)?n.params:_.isNil(t)?null:angular.isArray(t)?t:[t])})})}e.$inject=["$scope","$element","$attrs"],angular.module("itaca.directives").directive("chEventsManager",function(){return{restrict:"A",controller:e}})}(),function(){"use strict";function e(a){return{restrict:"A",require:"ngModel",scope:{ngModel:"=",chInputCheck:"="},link:function(n,e,t,i){n.check=function(){a.when(n.chInputCheck(n.ngModel),function(e){i.$setValidity("chValid",e),i.$checking=!1},function(){i.$setValidity("chValid",!1),i.$checking=!1},function(){i.$checking=!0})},n.$watchCollection("ngModel",function(e,t){_.isNil(e)||_.isEmpty(e)?i.$setValidity("chValid",!0):(i.$setValidity("chValid",!1),n.check())})}}}e.$inject=["$q"],angular.module("itaca.directives").directive("chInputCheck",e)}(),function(){"use strict";function e(d,u){return{restrict:"A",scope:{defaultImgUrl:"=",maxRetry:"=",hideOnError:"=?",onLoad:"&?"},link:function(n,i,e){var t,a,o=e.loadedClass,r="lipr_"+Date.now(),s=s||3,c=0;function l(){if(i.addClass("hide"),i[0].style.setProperty("display","none","important"),!n.hideOnError&&!document.getElementById(r)){var e=angular.element('<md-progress-circular id="'+r+'" class="md-primary ch-progress" md-mode="indeterminate"></md-progress-circular>');i.after(e),d(e)(n)}}n.hideOnError=!!_.isBoolean(n.hideOnError)&&n.hideOnError,i.on("load",function(e){n.onLoad&&n.onLoad(),clearTimeout(a),i.css("display","inherit"),i.addClass(o),i.removeClass("hide");var t=document.getElementById(r);t&&angular.element(t).remove()}),i.on("error",function(){!function e(){s<=c?_.isNil(n.defaultImgUrl)||(i[0].src=n.defaultImgUrl):(l(),a||(a=setTimeout(function(){t||(t=i[0].src),i[0].src=u.withParam(t,"cache",Date.now().toString()),e(),c++},3e3)))}()}),l(),n.$on("$destroy",function(){clearTimeout(a)})}}}e.$inject=["$compile","UrlBuilder"],angular.module("itaca.directives").directive("lazyImage",e)}(),function(){"use strict";function e(a){return{restrict:"A",require:"mdDatepicker",link:function(e,t,n,i){t.find("input").on("click",function(e){a(i.openCalendarPane.on(i,e))})}}}e.$inject=["$timeout"],angular.module("itaca.directives").directive("mdDatepickerOnClick",e)}(),function(){"use strict";function e(e){return{restrict:"A",require:"mdDatepicker",link:function(e,t,n,i){t.find("input").attr("readonly","readonly")}}}e.$inject=["$timeout"],angular.module("itaca.directives").directive("mdDatepickerReadonly",e)}(),function(){"use strict";function e(c,e){return{restrict:"A",scope:{onClickPanel:"=",ctrl:"@",xPosition:"@",yPosition:"@",hasBackdrop:"=?",disableParentScroll:"=?",disableBodyScroll:"=?",clickOutsideToClose:"=?",hasConfirm:"=?",hasClose:"=?",panelClass:"@",data:"=?",onClose:"&?",zIndex:"@",fullscreen:"=?"},link:function(n,e,t){n.xPosition=_.includes(["CENTER","ALIGN_START","ALIGN_END","OFFSET_START","OFFSET_END"],n.xPosition)?n.xPosition:"CENTER",n.yPosition=_.includes(["CENTER","ALIGN_TOPS","ALIGN_BOTTOMS","ABOVE","BELOW"],n.yPosition)?n.yPosition:"BELOW",n.clickOutsideToClose=n.clickOutsideToClose||!0,n.panelClass=n.panelClass||"bg-white md-whiteframe-15dp",n.hasBackdrop=!!_.isNil(n.hasBackdrop)||n.hasBackdrop;var i=e[0],a=function(e){angular.element(document.body).css({overflow:e?"hidden":"auto"})},o=c.newPanelPosition().relativeTo(e).addPanelPosition(c.xPosition[n.xPosition],c.yPosition[n.yPosition]),r={attachTo:angular.element(document.body),controller:n.ctrl||"basePanelCtrl",controllerAs:"ctrl",templateUrl:n.onClickPanel,position:o,clickOutsideToClose:n.clickOutsideToClose,disableParentScroll:n.disableParentScroll,hasBackdrop:n.hasBackdrop,fullscreen:!!_.isBoolean(n.fullscreen)&&n.fullscreen,panelClass:n.panelClass,locals:{data:n.workingData,hasConfirm:n.hasConfirm,hasClose:n.hasClose},onCloseSuccess:function(e,t){(!(!!_.isBoolean(n.hasConfirm)&&n.hasConfirm)||_.isBoolean(t)&&t)&&(_.assign(n.data,n.workingData),n.onClose&&n.onClose(n.data)),(n.hasBackdrop||n.disableBodyScroll)&&a(!1)},onOpenComplete:function(){(n.hasBackdrop||n.disableBodyScroll)&&a(!0)}};n.zIndex&&(r.zIndex=n.zIndex);var s=function(e){n.data=n.data||{},n.workingData=angular.copy(n.data),r.openFrom=e,r.locals=n.locals||{hasConfirm:n.hasConfirm,hasClose:n.hasClose},r.locals.data=n.workingData,c.open(r)};i.addEventListener("click",s),n.$on("$destroy",function(){i.removeEventListener("click",s)})}}}e.$inject=["$mdPanel","$mdMedia"],angular.module("itaca.directives").directive("onClickPanel",e)}(),function(){"use strict";function e(i,d,a){return{restrict:"A",scope:{socialLogin:"@",provider:"@",reload:"="},link:function(c,e,t){var l=c.socialLogin||c.provider;function n(e){e.preventDefault();var t,n,i,a,o=(t=window.screenLeft?window.screenLeft:window.screenX,n=window.screenTop?window.screenTop:window.screenY,i=t+window.innerWidth/2-325,a=n+window.innerHeight/2-325,{w:650,h:650,left:i,top:a}),r="/signin/"+l+"/popup",s="scrollbars=yes, width="+o.w+", height="+o.h+", top="+o.top+", left="+o.left;c.popup=window.open(r,"socialLogin",s),c.stop||(c.stop=d(function(){c.loginCallback()},1e3))}c.popup={},c.stopCheck=function(){angular.isDefined(c.stop)&&(d.cancel(c.stop),c.stop=void 0)},c.loginCallback=function(){c.popup&&c.popup.closed&&(i.info("Popup closed"),a.loadUserDetails(),_.isBoolean(c.reload)&&c.reload&&a.reload(),c.unregister())},c.unregister=function(){c.stopCheck()},c.$on("destroy",c.unregister),e.bind("click",function(e){n(e)})}}}e.$inject=["$log","$interval","Navigator"],angular.module("itaca.directives").directive("socialLogin",e)}(),function(){"use strict";function e(d){return{restrict:"A",scope:{parent:"@stickyParent",offset:"@stickyOffset",cssClass:"@stickyClass",parentWidth:"@hasParentWidth",isSticky:"=?"},link:function(e,t,n){var i,a,o,r,s=e.parent?document.querySelector(e.parent):t.parent()[0],c=e.offset||0;e.isSticky=e.isSticky||!1,s.style.position="relative";var l=function(){i=s.offsetHeight,a=s.offsetTop-c,o=t[0].offsetHeight,d.pageYOffset>=a&&d.pageYOffset<=a+(i-o)?(e.isSticky=!0,e.parentWidth&&(r=s.offsetWidth+"px"),t.css({position:"fixed",top:c+"px","z-index":"10",bottom:"",width:r}),e.cssClass&&t.addClass(e.cssClass)):(d.pageYOffset>=a&&d.pageYOffset>a+(i-o)?t.css({position:"absolute",bottom:"0","z-index":"",top:"",width:""}):t.css({position:"absolute",bottom:"","z-index":"",top:"0",width:""}),e.cssClass&&t.removeClass(e.cssClass),e.isSticky=!1)};d.addEventListener("scroll",l),e.$on("$destroy",d.removeEventListener("scroll",l))}}}e.$inject=["$window"],angular.module("itaca.directives").directive("chSticky",e)}(),function(){"use strict";function e(a){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){a.transform(t,i,function(e){return angular.isString(e)&&0<e.length?e[0].toUpperCase()+e.substr(1).toLowerCase():e})}}}e.$inject=["textTransformService"],angular.module("itaca.directives").directive("textCapitalize",e)}(),function(){"use strict";function e(a){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){a.transform(t,i,angular.lowercase)}}}e.$inject=["textTransformService"],angular.module("itaca.directives").directive("textLowercase",e)}(),function(){"use strict";function e(a){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){a.transform(t,i,angular.uppercase)}}}e.$inject=["textTransformService"],angular.module("itaca.directives").directive("textUppercase",e)}(),function(){"use strict";function e(e,a){return{restrict:"A",require:"ngModel",link:function(t,e,n,i){i.$viewChangeListeners.push(function(){if(i.$modelValue&&angular.isDate(i.$modelValue)){var e=n.tzDate;e&&a(n.ngModel).assign(t,moment(i.$modelValue).utcOffset(e,!0).toDate())}})}}}e.$inject=["DateUtils","$parse"],angular.module("itaca.directives").directive("tzDate",e)}(),function(){"use strict";function e(a,o){return{restrict:"A",require:"ngModel",link:function(e,t,n,i){i.$viewChangeListeners.push(function(){i.$modelValue&&angular.isDate(i.$modelValue)&&o(n.ngModel).assign(e,a.absoluteDate(i.$modelValue))})}}}e.$inject=["DateUtils","$parse"],angular.module("itaca.directives").directive("utcDate",e)}();